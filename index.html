<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Photo Detector - Safe Version</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    function App() {
      const [preview, setPreview] = useState(null);
      const [result, setResult] = useState(null);
      const [loading, setLoading] = useState(false);

      const handleUpload = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        // Preview
        const reader = new FileReader();
        reader.onload = () => setPreview(reader.result);
        reader.readAsDataURL(file);

        // Convert to base64
        const base64Reader = new FileReader();
        base64Reader.onload = async () => {
          const base64 = base64Reader.result.split(",")[1];

          setLoading(true);
          setResult(null);

          try {
            const response = await fetch("/api/analyze", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                base64,
                type: file.type
              })
            });

            const json = await response.json();
            setResult(json);
          } catch (err) {
            setResult({ error: "Failed to analyze" });
          }

          setLoading(false);
        };

        base64Reader.readAsDataURL(file);
      };

      return (
        <div className="p-6 max-w-3xl mx-auto">
          <h1 className="text-3xl font-bold text-center mb-6">AI Photo Detector</h1>

          <input type="file" accept="image/*" onChange={handleUpload} />

          {preview && (
            <img src={preview} className="mt-4 rounded shadow" />
          )}

          {loading && (
            <p className="mt-4 text-purple-600 text-lg">Analyzing...</p>
          )}

          {result && (
            <pre className="bg-gray-100 p-4 rounded mt-4">
              {JSON.stringify(result, null, 2)}
            </pre>
          )}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
